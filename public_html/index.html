<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    </head>
    <style>
        .seguent{
            width: 100px !important;
            height: 100px !important;
        }
        table {
            border-radius: 5px;
            text-align: center;
            width: 375px;
            height: 625px;
            background-color:#111111; 
        }
        .pieza {
            background-color: #ba4c55;
        }
        .pared {
            background-color: #707070;
        }
    </style>
    <body id="all">
        <img src="img/black.png" id="negre" style="display: none;">
        <!--<canvas id="espai" width="550" height="550"> </canvas>-->
        <div id="joc">

        </div>
    </body>
    <script>
        var Pieza = function (formaYColor, x, y) {
            console.log(formaYColor);
            this.forma = formaYColor[0];
            this.color = formaYColor[1];
            this.x = x;
            this.y = y;
        };
        function GeneraPecaAleatoria() {
            var peces = [
                [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "groc"],
                [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0]], "lila"],
                [[[0, 0, 0, 0], [0, 1, 1, 0], [1, 1, 0, 0], [0, 0, 0, 0]], "verd"],
                [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 0, 1, 1], [0, 0, 0, 0]], "roig"],
                [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "blau"],
                [[[0, 1, 1, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "taronga"],
                [[[0, 0, 0, 0], [1, 1, 1, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "morat"]];
            var numeroAleatori = Math.round(Math.random() * 6);
            return peces[numeroAleatori];
        }

        Pieza.prototype.moureDreta = function () {
            if ((x - 1) > 0) {
                x--;
                return true;
            } else {
                return false;
            }
        };

        Pieza.prototype.moureEsquerra = function () {
            if ((x + 1) < 14) {
                x++;
                return true;
            } else {
                return false;
            }
        };

        Pieza.prototype.moureAbaix = function () {
            if (y - 1 > 0) {
                y--;
                return true;
            } else {
                return false;
            }
        };

        Pieza.prototype.rotarDreta = function () {
            var formaNova = new Array();
            for (var i = 0; i < this.forma.length; i++) {
                formaNova[i] = new Array();
                for (var j = 0; j < this.forma[i].length; j++) {
                    formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                }
            }
            this.forma = formaNova;
        };
        Pieza.prototype.rotarEsquerra = function () {
            this.rotarDreta();
            this.rotarDreta();
            this.rotarDreta();
        };
        Pieza.prototype.pintar = function ()
        {
            var resultat = "<table class=seguent>";
            for (var i = 0; i < this.forma.length; i++)
            {
                resultat = resultat + "<tr>";
                for (var j = 0; j < this.forma[i].length; j++)
                {

                    if (this.forma[i][j] === 1) {
                        resultat = resultat + "<td class=pieza>";
                        resultat = resultat + "1";
                        resultat = resultat + "</td>";
                    } else {
                        resultat = resultat + "<td>";
                        resultat = resultat + "-";
                        resultat = resultat + "</td>";
                    }

                }
                resultat = resultat + "</tr>";
            }
            resultat = resultat + "</table>";
            return resultat;
        };
        Pieza.prototype.getForma = function () {
            return this.forma;
        };
        var Joc = {
            espai: 0,
            estat: 0,
            puntuacio: 0,
            puntuacioMax: 0,
            pecaVigent: new Pieza(GeneraPecaAleatoria(), 3, 0),
            seguentPeca: new Pieza(GeneraPecaAleatoria(), 3, 0),
            nombreDeVegades: new Array(),
            interval: 0,
            nivell: 0,
            teclat: document.getElementById("all"),
            inicialitzarJoc: function () {
                this.espai = [
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                ];
                this.nombreDeVegades["i"] = 0;
                this.nombreDeVegades["j"] = 0;
                this.nombreDeVegades["l"] = 0;
                this.nombreDeVegades["o"] = 0;
                this.nombreDeVegades["s"] = 0;
                this.nombreDeVegades["t"] = 0;
                this.nombreDeVegades["z"] = 0;
                this.nivell = 1;

                this.teclat = this.teclat.addEventListener("keydown", this.teclatUsuari);



                var este = this;

                setInterval(function () {
                    este.movimiento();
                }, 100);

            },

            teclatUsuari: function (e) {
                //todo input 
                if (e.keyCode === 40) {//abajo
                    this.pecaVigent.moureAbaix();
                } else if (e.keyCode === 38) {//arriba

                } else if (e.keyCode === 37) {//esquerra
                    console.log(this.pecaVigent.x);
                } else if (e.keyCode === 39) {//dreta
                }
            },
            intervalJoc: function () {
            },
            haChocat: function () {
                //todo
                for (var i = 0; i < this.espai.length; i++) {
                    for (var j = 0; j < this.espai[i].length; j++) {
                        if (this.espai[i][j] === "P") {
                            try {
                                if (this.espai[i + 1][j] === 1) {
                                    return true;
                                }
                            } catch (e) {
                                console.log(e);
                            }
                            try {
                                if (this.espai[i - 1][j] === 1) {
                                    return true;
                                }
                            } catch (e) {
                                console.log(e);
                            }
                            try {
                                if (this.espai[i][j + 1] === 1) {
                                    return true;
                                }
                            } catch (e) {
                                console.log(e);
                            }
                            try {
                                if (this.espai[i][j - 1] === 1) {
                                    return true;
                                }
                            } catch (e) {
                                console.log(e);
                            }
                        }
                    }
                }

                return false;
            },
            parar: function () {
                if (this.pecaVigent.color === "lila") { //si es el palo 
                    if (this.pecaVigent.y < 21) {
                        return false;
                    } else {
                        return true;
                    }
                } else if (this.pecaVigent.color === "taronga" || this.pecaVigent.color === "blau") {
                    console.log("a")
                    if (this.pecaVigent.y < 22) {
                        return false;
                    } else {
                        return true;
                    }
                } else {
                    if (this.pecaVigent.y < 23) {
                        return false;
                    } else {
                        return true;
                    }
                }
            }, seguentEsParet: function () {
                var bool = false;
                for (var i = 0; i < this.espai.length; i++) {
                    for (var j = 0; j < this.espai[i].length; j++) {
                        if (this.espai[i][j] === "P") {
                            if (i + 1 <= 24) {
                                if (this.espai[i + 1][j] === 1) {
                                    bool = true;
                                }
                            }
                        }
                    }
                }
                return bool;
            },
            cambiarPieza: function () {
                this.pecaVigent = this.seguentPeca;
                this.pecaVigent.x = 3;
                this.pecaVigent.y = 0;
                this.seguentPeca = new Pieza(GeneraPecaAleatoria(), 3, 0);

                this.vaciarEspacio(1);


            },
            movimiento: function () {


                this.vaciarEspacio(0);
                this.colocarPiezaATauler();
                if (this.parar() === false && this.seguentEsParet() === false) {
                    this.pecaVigent.y++;
                } else {
                    this.cambiarPieza();
                }
                this.pinta();

            },
            vaciarEspacio: function (parametro) {
                for (var i = 0; i < this.espai.length; i++) {
                    for (var j = 0; j < this.espai[i].length; j++) {
                        if (this.espai[i][j] === "P") {
                            this.espai[i][j] = parametro;
                        }
                    }
                }
            },
            pinta: function () {
                document.getElementById('joc').innerHTML = "";
                var print;

                print = "Nivell: " + this.nivell + "<br>";
                print += ("Puntuació Màxima: " + this.puntuacioMax);
                print += ("<br>Puntuació Actual: " + this.puntuacio + "<br><br>Peça següent");
                print += (this.seguentPeca.pintar() + "<br>");


                print += "<table>";
                for (var i = 0; i < this.espai.length; i++) {
                    print += "<tr>";
                    for (var j = 0; j < this.espai[i].length; j++) {
                        if (this.espai[i][j] === "P") {
                            print += "<td class='pieza'>" + "</td>";
                        } else if (this.espai[i][j] === 1) {
                            print += "<td class='pared'>" + "</td>";
                        } else {
                            print += "<td>" + "</td>";
                        }
                    }
                    print += ("</tr>");
                }
                print += "</table>";

                document.getElementById('joc').innerHTML = print;

            },
            colocarPiezaATauler: function () {
                var top = 0;
                var trobat = false;
                for (var i = 0; i < this.pecaVigent.forma.length; i++) {
                    for (var j = 0; j < this.pecaVigent.forma[i].length; j++) {
                        if (this.pecaVigent.forma[i][j] === 1) {
                            this.espai[this.pecaVigent.y + top][this.pecaVigent.x + j] = "P";
                            trobat = true;
                        }
                    }
                    if (trobat === true) {
                        top++;
                    }
                }
            }
        };
        Joc.inicialitzarJoc();
    </script>
</html>
